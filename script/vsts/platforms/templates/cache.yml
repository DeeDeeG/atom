parameters:
  - name: OS
    displayName: Operating System
    type: string
    values:
      - windows
      - linux
      - macos

steps:
      - task: 1ESLighthouseEng.PipelineArtifactCaching.RestoreCacheV1.RestoreCache@1
        displayName: Restore node_modules cache
        inputs:
          keyfile: 'package.json, script/vsts/platforms/${{ parameters.OS }}.yml, **/package-lock.json, !**/node_modules/**/package-lock.json, !**/.*/**/package-lock.json, script/vsts/${{ variables.buildArch }}-cache-key'
          targetfolder: '**/node_modules, !**/node_modules/**/node_modules'
          vstsFeed: 'c4ca4bc0-0579-40b1-ac88-906ed61131cd'
        condition: eq(variables['Agent.OS'], 'Windows_NT')

      - task: 1ESLighthouseEng.PipelineArtifactCaching.RestoreCacheV1.RestoreCache@1
        displayName: Restore node_modules cache
        inputs:
          keyfile: 'package.json, script/vsts/platforms/${{ parameters.OS }}.yml, **/package-lock.json, !**/node_modules/**/package-lock.json, !**/.*/**/package-lock.json'
          targetfolder: '**/node_modules, !**/node_modules/**/node_modules'
          vstsFeed: 'c4ca4bc0-0579-40b1-ac88-906ed61131cd'
        condition: ne(variables['Agent.OS'], 'Windows_NT')
